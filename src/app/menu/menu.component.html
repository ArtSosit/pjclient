<div class="sticky-container">
  <h1>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
  <!-- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á modal ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ -->
  <button class="btn btn-primary" (click)="showModal = true">
    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  </button>
</div>
<div>
  <label for="cate">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
  <select class="form-select" id="categories" [(ngModel)]="selectedcate">
    <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    <option
      *ngFor="let category of categories"
      [value]="category.category_name"
    >
      {{ category.category_name }}
    </option>
  </select>
</div>

<div class="menu-container">
  <div class="menu-card" *ngFor="let menu of filteredMenus()">
    <!-- ‚≠ê ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏î‡∏≤‡∏ß (‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) -->
    <div
      class="star-icon"
      [class.active]="menu.is_recommended === 1"
      (click)="toggleRecommended(menu.item_id, menu.is_recommended)"
    >
      <span *ngIf="isBestSeller(menu.item_id)" class="badge bestseller-badge">
        üî• ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ
      </span>
      <i class="bi bi-star-fill"></i>
    </div>

    <img src="{{ menu.imageUrl }}" alt="menu-item" class="menu-image" />
    <div class="menu-content">
      <div>
        <h3>{{ menu.item_name }}</h3>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î -->
        <p *ngIf="menu.discount > 0" class="discount">
          ‡∏•‡∏î {{ menu.discount }} ‡∏ö‡∏≤‡∏ó
        </p>

        <p>
          ‡∏£‡∏≤‡∏Ñ‡∏≤:
          <span *ngIf="menu.discount > 0" class="original-price">
            {{ menu.price | number : "1.2-2" }} ‡∏ö‡∏≤‡∏ó
          </span>
          <span *ngIf="menu.discount > 0" class="discounted-price">
            {{
              getDiscountedPrice(menu.price, menu.discount) | number : "1.2-2"
            }}
            ‡∏ö‡∏≤‡∏ó
          </span>
          <span *ngIf="menu.discount === 0 || menu.discount === null"
            >{{ menu.price }} ‡∏ö‡∏≤‡∏ó</span
          >
        </p>

        <p>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: {{ menu.category }}</p>
      </div>

      <div class="form-check form-switch">
        <input
          class="form-check-input"
          type="checkbox"
          role="switch"
          id="flexSwitchCheckDefault"
          [checked]="menu.status === 'available'"
          (change)="toggleStatus(menu.item_id)"
        />
        <label class="form-check-label" for="flexSwitchCheckDefault">
          {{ menu.status === "available" ? "ON" : "OFF" }}
        </label>
      </div>

      <div>
        <button
          class="btn btn-warning"
          data-bs-toggle="modal"
          data-bs-target="#discountModal"
          (click)="setDiscount(menu)"
        >
          ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤
        </button>
        <button
          *ngIf="menu.discount > 0"
          class="btn btn-secondary"
          (click)="cancelDiscount(menu.item_id)"
        >
          ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤
        </button>
        <button class="btn btn-danger" (click)="DeleteMenu(menu.item_id)">
          ‡∏•‡∏ö
        </button>
        <button class="btn btn-success" (click)="editMenu(menu)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ showModal ‡πÄ‡∏õ‡πá‡∏ô true -->
<div *ngIf="showModal" class="modal-backdrop">
  <div class="modal-container">
    <div class="modal-header">
      <h5>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h5>
      <!-- ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ -->
      <button type="button" class="close-btn" (click)="clearMenu()">
        &times;
      </button>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="menuImage">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
          <input
            type="file"
            (change)="onFileChange($event, 'menuImage')"
            id="menuImage"
            name="menuImage"
          />
        </div>
        <div class="form-group">
          <label for="menuName">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
          <input
            type="text"
            class="form-control"
            id="menuName"
            [(ngModel)]="newMenu.name"
            name="menuName"
          />
        </div>
        <div class="form-group">
          <label for="menuPrice">‡∏£‡∏≤‡∏Ñ‡∏≤</label>
          <input
            type="number"
            class="form-control"
            id="menuPrice"
            [(ngModel)]="newMenu.price"
            name="menuPrice"
          />
        </div>
        <label for="menuCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
        <select
          class="form-control"
          id="menuCategory"
          [(ngModel)]="newMenu.category"
          name="menuCategory"
          (change)="checkCategory($event)"
        >
          <option *ngFor="let category of categories" [ngValue]="category">
            {{ category.category_name }}
          </option>
          <option value="new">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà...</option>
        </select>

        <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà (‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà) -->
        <div class="form-group" *ngIf="addingNewCategory">
          <label for="newCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</label>
          <input
            type="text"
            class="form-control"
            id="newCategory"
            [(ngModel)]="newCategory"
            name="newCategory"
            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà"
          />
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="clearMenu()">‡∏õ‡∏¥‡∏î</button>
      <button class="btn btn-primary" (click)="addMenu()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </div>
  </div>
</div>

<!-- Modal ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ editModal ‡πÄ‡∏õ‡πá‡∏ô true -->
<div *ngIf="editModal" class="modal-backdrop">
  <div class="modal-container">
    <div class="modal-header">
      <h5>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h5>
      <button type="button" class="close-btn" (click)="clearMenu()">
        &times;
      </button>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="menuName">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
          <input
            type="text"
            class="form-control"
            id="menuName"
            [(ngModel)]="newMenu.name"
            name="menuName"
          />
        </div>
        <div class="form-group">
          <label for="menuPrice">‡∏£‡∏≤‡∏Ñ‡∏≤</label>
          <input
            type="number"
            class="form-control"
            id="menuPrice"
            [(ngModel)]="newMenu.price"
            name="menuPrice"
          />
        </div>
        <label for="menuCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
        <select
          class="form-control"
          id="menuCategory"
          [(ngModel)]="newMenu.category"
          name="menuCategory"
          (change)="checkCategory($event)"
          required
        >
          <option *ngFor="let category of categories" [ngValue]="category">
            {{ category.category_name }}
          </option>

          <option value="new">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà...</option>
        </select>

        <div class="form-group" *ngIf="addingNewCategory">
          <label for="newCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</label>
          <input
            type="text"
            class="form-control"
            id="newCategory"
            [(ngModel)]="newCategory"
            name="newCategory"
            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà"
          />
        </div>

        <div class="form-group">
          <label for="menuImage">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
          <input
            type="file"
            class="form-control"
            id="menuImage"
            (change)="onFileChange($event, 'menuImage')"
            [(ngModel)]="newMenu.imageUrl"
            name="menuImage"
          />
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="clearMenu()">‡∏õ‡∏¥‡∏î</button>
      <button class="btn btn-primary" (click)="editcategory()">
        ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </button>
    </div>
  </div>
</div>

<!-- ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ -->
<div
  class="modal"
  id="discountModal"
  tabindex="-1"
  aria-labelledby="discountModal"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="discountModal">
          <h1>‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <p>‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ "{{ selectedMenu?.item_name }}"</p>
            <label for="discount">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î</label>
            <input
              type="number"
              class="form-control"
              id="discount"
              [(ngModel)]="newMenu.discount"
              name="discount"
              placeholder="{{ selectedMenu?.price }}"
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
          (click)="resetDiscountForm()"
        >
          Close
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="discountMenu(selectedMenu?.item_id)"
        >
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </button>
      </div>
    </div>
  </div>
</div>
